/*
Discover Hidden Elements - Open Headlines and Footnotes that are linked to but hidden
See detailed documentation in Dev/mediawiki
deferrable:YES -- This is a standalone gadget / augmentation
*/

(function() {
	
	// Search and apply to all footnotes and all headlines, but NOT headlines for tab controller tabs (because they are already handled)
	
	$( '[id^="cite_note-"], .mw-headline[id]:not(.tcc-title > * > *)' ).each( function() {
		
		let elem = $(this);
		
		console.log( elem );
		
		mwDev.tools.hashControl.register( elem.attr('id'), function() {
			// If element is visible no action is needed
			if( elem.is(':visible') ) return;
			
			// Click all tab controller parents, from nearest to root, to farthest
			$( elem.parents('.tcc-section, .mw-collapsible-toggle-collapsed').get().reverse() ).each( function() {
				if( $(this).hasClass('tcc-section') ) $( `.tcc-tab[data-tcc-contentid="${ $(this).attr('data-tcc-contentid') }"]` )[0].click();
			});
			
			// Scroll to position
			setTimeout( () => $('html, body').animate( { scrollTop: elem[0].getBoundingClientRect().top + window.pageYOffset - 70  }, 500 ), 100 );
		}, true );
		
	});
	
})();

/*
[[Category:MultiWiki]]
*/