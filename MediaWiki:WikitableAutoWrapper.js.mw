/*
Auto-wraps ".wikitable" elements in a wrapper with helper elements to guarantee 100% width and indicate scrollability
See detailed documentation in Dev/mediawiki
deferrable:YES -- The user will not need (or see) this info immediately anyways
*/

(function () {
	
	const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
	
	$('table.wikitable').each( function() {
		let table = $(this);
		let wrapper = $('<div class="wikitable-auto-wrapper"><div class="before"></div><div class="table-content"></div><div class="after"></div>');
		
		let originalTableHeight = table.height();
		
		// In cases where the table is hidden, for example in mw-collapsible
		/*
		if( originalTableHeight == 0 ) {
			let placeholder = $('<div></div>');
			let container = $('<div></div>').css( {
				width: table.parents().filter( function() { if( $(this).has(class) ) return true; } ).eq(0).innerWidth(),
				opacity: 0,
			} );
			console.log( table.parent(), table.parent().width() ); 
			placeholder.insertBefore( table );
			container.append( table );
			$('body').append( container );
			originalTableHeight = table.height();
			table.insertBefore( placeholder );
			placeholder.remove();
			container.remove();
		}
		*/
		
		wrapper.css( 'height', originalTableHeight );
		
		let tableContentDiv = wrapper.find('.table-content');
		wrapper.insertBefore( table );
		tableContentDiv.append( table );
		
		if( isMobile && tableContentDiv.width() < tableContentDiv.prop('scrollWidth') ) {
			wrapper.addClass('scroll-overflow-mobile');
			wrapper.css( 'top', - wrapper.children('.before').height() );
		}
	});

})();

/*
[[Category:MultiWiki]]
*/