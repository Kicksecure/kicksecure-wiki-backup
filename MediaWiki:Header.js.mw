/*
Custom Header - JS Initialisation, Setup, Events
See detailed documentation in Dev/mediawiki
deferrable:YES -- It needs time for loading anyways
*/

(function() {
	
	if( $('#custom-header').length == 0 ) return;
	
	
	// -----
	// Setup


	// Setup of super menu by current user status and watching status

	if( $('#pt-userpage').length > 0 ) {
		$('#custom-header .super-menu .headline.user').text('User: ' + $('#pt-userpage > a').text() );
	}

	// Watch indicator
	if( $('#ca-unwatch').length != 0 ) {
		$('body').addClass('page-is-watched');
	}
	
	// If no oldid was given in the search params, remove oldid from edit link
	let q = new URLSearchParams( window.location.search.substring(1) );
	$('#custom-header .super-menu .edit').attr( 'href', function( index, href ) {
		if( ! q.get('oldid') ) return href.replace( /&oldid=[^&$]+/, '' );
	});
	
	
	// ------
	// Events
	
	
	// Make MouseIn over header super menu activate super menu
	
	let superMenu = $('#custom-header .super-menu');
	let superMenuLocked;
	
	superMenu.on( 'mouseleave', () => superMenu.removeClass('active') );
	
	superMenu.children('.menu-title').on( 'mouseenter click', () => {
		if( superMenu.hasClass('active') || superMenuLocked ) return;
		
		superMenuLocked = true;
		superMenu.addClass('active');
		setTimeout( () => { superMenuLocked = false; }, 50 );
	});
	
	superMenu.children('.menu-title').on( 'click', function() {
		if( ! superMenu.hasClass('active') || superMenuLocked ) return;
		
		superMenuLocked = true;
		superMenu.removeClass('active');
		setTimeout( () => { superMenuLocked = false; }, 50 );
	});
	
})();

/*
[[Category:MultiWiki]]
*/