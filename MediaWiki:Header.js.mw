/*
Custom Header - JS Initialisation, Setup, Events
See detailed documentation in Dev/mediawiki
deferrable:YES -- It needs time for loading anyways
*/

(function() {
	
	if( $('#custom-header').length == 0 ) return;
	
	// -----
	// Setup

	// Setup of super menu by current user status and watching status

	if( $('#pt-userpage').length > 0 ) {
		$('#custom-header .super-menu .headline.user').text('User: ' + $('#pt-userpage > a').text() );
	}

	// Watch indicator
	if( $('#ca-unwatch').length != 0 ) {
		$('body').addClass('page-is-watched');
	}
	
	// https://www.kicksecure.com/w/index.php?title=Homepage&action=edit&oldid=66827
	
	// If no oldid was given remove oldid from edit link
	let q = new URLSearchParams( window.location.search.substring(1) );
	$('#custom-header .super-menu .edit').attr( 'href', function( index, href ) {
		if( ! q.get('oldid') ) return href.replace( /&oldid=[^&$]+/, '' );
	});
	
})();