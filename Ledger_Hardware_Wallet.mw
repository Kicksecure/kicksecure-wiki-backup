{{Header}}
{{#seo:
|description=Installation, Setup, Security, Ledger Live, Electrum
|image=Ledger_Nano_S_-_Hard_Wallet_-_Cold_Storage_for_Cryptocurrency_04.jpg
}}
{{Title|
title=How-to: Ledger Hardware Wallet in {{project_name_long}}
}}
{{crypto_hardware_wallets_mininav}}
[[File:Ledger_Nano_S_-_Hard_Wallet_-_Cold_Storage_for_Cryptocurrency_04.jpg|thumb]]
{{intro|
Installation, Setup, Security, Ledger Live, Electrum

Update on 25 May 2023: [[Hardware_Wallet_Security#Key_Extraction|Ledger Recovery key extraction]].
}}
[[File:Ledgericon.png|Ledger Hardware Wallet Logo|thumb]]
= Introduction =
{{mbox
| image   = [[File:Ambox_warning_pn.svg.png|40px]]
| text    = Testers only!
}}

{{mbox
| type    = notice
| image   = [[File:Ambox_notice.png|40px|alt=Info]]
| text    = Documentation status: Successful connection to a Ledger hardware wallet from within a [[Kicksecure]] VirtualBox VM confirmed on 25 February 2021.
}}

{{mbox
| image   = [[File:Ambox_warning_pn.svg.png|40px]]
| text    = The concepts in this chapter are still valid but the applications and corresponding installation instructions may have changed in the meantime.
}}

[https://www.ledger.com/ Ledger wallets] are a special type of commercial Bitcoin wallet whereby a user's private keys are stored in a secure hardware device. Other commercial alternatives include Pi Wallet, TREZOR, BWALLET, KeepKey, Opendime, CoolWallet and others.

The major advantages of hardware wallets over software wallets include: <ref>
https://en.bitcoin.it/wiki/Hardware_wallet
</ref>

* Usually private keys are stored in a protected area of a microcontroller, and cannot be transferred out of the device in plaintext.
* Resistance to computer viruses that target theft from software wallets.
* More secure and interactive than paper wallets that require importation to software.
* Usually software on the device is open source.

The main principle is that cryptographic secrets (private keys) are fully isolated from easy-to-hack computers or smartphones. Ledger wallets use secure chips that are similar to the technology used in chip and PIN payment cards or SIM cards. <ref>
https://www.ledger.com/ledger-wallets-always-safe-never-sorry
</ref>

= Security Factors =
== Essentials ==
Learn from Ledger and/or other authoritative sources:

* What is a seed phrase?
* [https://blog.kraken.com/post/6746/ledger-phishing-scam-targets-crypto-hardware-wallet-users/ Ledger Phishing Scam Targets Crypto Hardware Wallet Users]
{{mbox
| image   = [[File:Ambox_warning_pn.svg.png|40px]]
| text    = Never enter the seed phrase on any electronic device except the hardware wallet!
}}
* [https://support.ledger.com/hc/en-us/articles/4404389367057-Is-my-Ledger-device-genuine-?support=true Check if device is genuine]

== Security Risks ==

{{mbox
| image   = [[File:Ambox_warning_pn.svg.png|40px]]
| text    = '''Warning:''' Hardware wallets are not bulletproof. The user must be sure to purchase a good-quality, authentic device manufactured by a trustworthy and technically competent company with a good reputation in security.
}}

Potential risks of hardware wallets include: <ref>
https://en.bitcoin.it/wiki/Hardware_wallet
</ref>

* <u>Compromised production process</u>: Hardware backdoors could be introduced via intentional or unintentional actions that leave security holes in the final product.
* <u>Device interdiction</u>: No hardware wallet solution can deal with the threat of government programs that intercept hardware and modify them in transit to introduce backdoors.
* <u>Imperfect implementation</u>: If bugs are present in the software, firmware or hardware, then attackers may be able to gain unauthorized access to the hardware wallet.
* <u>Insecure Random Number Generator (RNG)</u>: Security relies on true randomness being generated by the source of entropy for the RNG, since it generates the wallet's private keys. This is hard to verify, and attackers may be able to recreate wallet keys if the RNG is insecure. <ref>
The attacker generates pseudo-randomness that is indistinguishable from true randomness, but is still predictable.
</ref>
*  <u>Malware swapping recipient Bitcoin addresses</u>: Malware on a PC could potentially trick the user into sending Bitcoin to the wrong address. Multi-factor confirmation of a recipient's Bitcoin address mitigates this risk.

Despite these risks, hardware wallets are considered a higher security solution than software wallets, since the latter must make private keys available in plain text in the computer's memory when transactions are signed -- any compromise by Bitcoin-targeting malware would enable theft of Bitcoins.

== Seed Backup Security ==

It is definitely safer to have at least two Ledger hardware wallets. During initial setup, the Ledger will ask you to confirm the Secret Recovery Phrase by selecting the requested words in order (word #1 through word #24). This helps to verify the phrase was backed up correctly. On the other hand, two Ledgers using the same seed should generate the same addresses, which proves the seed was correctly backed up.

Seed testing applications are available like [https://github.com/parkerhoyes/bolos-app-seedutility BOLOS Seed Utility App]. <ref>
<blockquote>This repository contains an application for the Ledger Nano S that allows the user to verify the backup of their BIP 39 mnemonic by comparing it to the master seed stored on the device.</blockquote>
</ref> <ref>
https://www.reddit.com/r/ledgerwallet/comments/6ez4qs/ledger_nano_s_seed_utility_app_released/
</ref> It is probably safer to avoid these tools since they are maintained by a third party and this adds complexity to the procedure.

Another alternative is to:

# note some generated addresses
# reset the Ledger
# set up again with the seed and see if it still uses the same addresses

== Wallet Testing Security ==

Before storing any significant funds in a wallet, it is recommended to first test sending a small amount there and then trying to send it back. The reason is software bugs could potentially lead to the presentation of an address where the user does not own the corresponding private key.

The threat of losing funds due to software bugs is not just hypothetical. For instance, [https://www.reddit.com/r/ethereum/comments/48rt6n/using_myetherwalletcom_just_burned_me_for/ this user] utilizing MyEtherWallet.com lost over one thousand dollars due to a historical bug in the Ethereum Javascript implementation.

== Threat Model ==
{{mbox
| image   = [[File:Ambox_warning_pn.svg.png|40px]]
| text    = Highly recommended reading: [[Hardware Wallet Security]]
}}

= Installation =
== USB ==
{{mbox
| type    = notice
| image   = [[File:Ambox_notice.png|40px|alt=Info]]
| text    = A USB port is required if using the Nano S, Nano or HW1 Ledger hardware wallets.
}}

{{mbox
| type    = notice
| image   = [[File:Ambox_notice.png|40px|alt=Info]]
| text    = Ledger USB device will not be detected by the computer before the PIN has been entered. <ref>
This is probably because Ledger does not announce itself before that.
</ref> Before proceeding:

# Physically connect the Ledger hardware wallet to a USB port.
# Turn on Ledger.
# Enter the PIN on the Ledger.
}}

== Virtualizer Specific Settings ==
=== VirtualBox ===
{{project_name_short}} [[VirtualBox]] users only:

{{mbox
| type    = notice
| image   = [[File:Ambox_notice.png|40px|alt=Info]]
| text    = VirtualBox 7 or higher is required.
}}

Add the Ledger hardware wallet to the virtual machine (VM).

# Power off the VM.
# <code>Virtual machine</code> &rarr; <code>Menu</code> &rarr; <code>Settings</code> &rarr; <code>USB</code> &rarr; <code>USB</code> &rarr; check <code>Enable USB Controller</code> &rarr; press <code>+</code> &rarr; check <code>Ledger</code> &rarr; <code>OK</code>
# Power on the VM.
# Repeat the above after you open an app on the Ledger device, i.e.: Bitcoin, Ethereum, Litecoin etc. It turns out that the Ledger device has a distinct hardware ID for each app you open on the hardware wallet.

[[Dev/VirtualBox#VirtualBox_Oracle_VM_VirtualBox_Extension_Pack|VirtualBox Oracle VM VirtualBox Extension Pack]] <u>not</u> required.

=== KVM ===
{{project_name_short}} [[KVM]] users only:

Add the Ledger hardware wallet to the virtual machine (VM).

[[Undocumented]].

=== Qubes ===
{{q_project_name_long}} users note:

For better usability, it is discouraged to start with a Ledger hardware wallet. First learn how to pass any other, "simpler" USB device to an AppVM and attempt that procedure in order to iron out any eventual Qubes USBVM issues. Any eventual Qubes USBVM issues are Qubes support issues. Not {{project_name_short}} support issues.

Install Qubes USB Proxy. This step is mandatory for [[Qubes]] users. <ref>
See:
[https://github.com/QubesOS/qubes-issues/issues/2473#issuecomment-273634599 Problem with adding USB device to a VM].
</ref>

{{Install_Package|package=
qubes-usb-proxy
}}

== Electrum Installation ==

This step is optional and only necessary if you intend to use Electrum.

[[Electrum]] is installed by default in {{project_name_workstation_long}}, but additional packages are required for hardware wallet support. <ref>
https://electrum.readthedocs.io/en/latest/hardware-linux.html
</ref>

Prefer Debian packages. <ref>
* https://packages.debian.org/python3-hidapi
* https://packages.debian.org/python3-btchip
</ref>

{{Install_Package|package=
python3-hidapi python3-btchip
}}

https://packages.debian.org/forky/python3-ledger-bitcoin might be required but unavailable in Debian trixie?

== udev Rules ==
{{Box|text=
'''1.''' Open a terminal.

<ref>
In most cases, device permissions are handled automatically. If the Ledger device is not detected, install <code>ledger-wallets-udev</code>, see below.
</ref>

'''2.''' Install package <code>ledger-wallets-udev</code>. <ref>
https://packages.debian.org/ledger-wallets-udev
</ref>

{{Install_Package|package=
ledger-wallets-udev
}}

'''3.''' {{non_q_project_name_long}} users only:

{{CodeSelect|code=
sudo udevadm control --reload-rules
}}

{{CodeSelect|code=
sudo udevadm trigger
}}

A reboot is usually not required for {{non_q_project_name_short}}; skip the next two steps to shut down and restart the VM.

'''4.''' Shut down VM.

'''5.''' Start the VM which is supposed to interact with the Ledger hardware wallet, which we will call <code>Ledger VM</code>.

'''6.''' Done.

<code>ledger-wallets-udev</code> udev rules were installed and udev was reloaded.
}}

== Ledger Live Application Installation ==
==== Introduction ====
{{always_verify_signatures_reminder}}

{{mbox
| type    = notice
| image   = [[File:Ambox_notice.png|40px|alt=Info]]
| text    = Ledger Live is now known as Ledger Wallet (formerly Ledger Live).
}}

{{mbox
| image   = [[File:Ambox_warning_pn.svg.png|40px]]
| text    = Two download methods are available.

* '''A)''' <u>Simplified</u>: Download instructions on this wiki page are simplified and less secure.
* '''B)''' <u>Secure</u>: Higher difficulty, but more secure download and digital software signature verification instructions are available on the [[Ledger_Live_Installation_with_Verification|How-to: Ledger Live Download with Digital Signature Verification]] wiki page. Apply those instructions and then return to this page.
}}

==== Download ====
{{CodeSelect|code=
scurl-download https://download.live.ledger.com/ledger-live-desktop-{{version_ledger_live}}-linux-x86_64.AppImage
}}

=== Make Executable ===
Make the Ledger Live AppImage executable.

{{CodeSelect|code=
chmod +x ledger-live-desktop-{{version_ledger_live}}-linux-x86_64.AppImage
}}

=== Ledger Live Start Menu Entry ===

{{mbox
| type    = notice
| image   = [[File:Ambox_notice.png|40px|alt=Info]]
| text    = This step is optional.
}}

'''1.''' Create folder <code>~/.local/share/applications</code>.

{{CodeSelect|code=
mkdir -p ~/.local/share/applications
}}

'''2.''' {{Open File
|filename=~/.local/share/applications/ledger.desktop
}}

'''3.''' Paste the following contents.

{{CodeSelect|code=
[Desktop Entry]
Name=Ledger Live
Comment=Ledger Live - Desktop
Exec=bash -c '~/ledger-live-desktop-*-linux-x86_64.AppImage'
Terminal=false
Type=Application
Icon=money-manager-ex
StartupWMClass=Ledger Live
MimeType=x-scheme-handler/ledgerhq;
Categories=Finance;
}}

'''4.''' Save.

'''5.''' ''{{q_project_name_short}} only:'' perform platform-specific steps.

In <code>dom0</code>:
* Refresh Qubes <code>dom0</code> appmenu: <code>VM settings</code> &rarr; <code>Applications</code> &rarr; <code>Refresh Applications</code>
* Add desktop shortcut.

= Usage =
== Ledger Live ==
# Physically connect the Ledger hardware wallet to a USB port.
# Enter the PIN on the Ledger.
# Start the <code>Ledger VM</code>.

Start Ledger Live.

{{CodeSelect|code=
./ledger-live-desktop-{{Version_ledger_live}}-linux-x86_64.AppImage
}}

For further actions, refer to upstream Ledger usage instructions.

== Electrum ==
Same basic steps as for [[#Ledger Live|Ledger Live]] but then start Electrum, not Ledger Live.

Do not attempt to run Electrum and Ledger Live at the same time. This is a Ledger limitation, unrelated to {{project_name_short}}.

An Electrum wallet will only show legacy Bitcoin addresses and their balances or SegWit wallet Bitcoin addresses and their balances, not both. It is possible to have multiple Electrum wallets and switch between them.

Electrum will ask for <code>derivation path</code>.

* The default is <code>m/44'/0'/0'</code> for legacy Bitcoin addresses.
* You should use <code>m/49'/0'/0'</code> for SegWit Bitcoin addresses.

= Troubleshooting =
== BIOS ==

The USB device might be passed to the <code>Ledger VM</code>, but Ledger applications may not recognize the Ledger hardware wallet. If that occurs, try the following in BIOS settings:

* Disable <code>Legacy USB Support</code>
* Disable <code>XHCI Pre-Boot Mode</code>
* Attempt flipping other USB-related BIOS options

It is unnecessary to reinstall Qubes.

== Ledger ==

To troubleshoot Ledger problems, try the following:

* Use the <code>Manager</code> tab in Ledger Live first.
* Qubes users note: Update the firmware of the Ledger hardware wallet by connecting it to a non-Qubes Linux computer (where connections are possible with Ledger Live).

== Try with Debian First ==
Issues which are not caused by {{project_name_short}}:

# Using Ledger on (Debian) Linux can be challenging.
# Using USB devices with VirtualBox can be challenging.
# Using Ledger with a virtualizer such as VirtualBox can be challenging.

Therefore, as per [[Self_Support_First_Policy|Self Support First Policy]]:

# Learn how to use Ledger on a Debian host.
# Learn how to use USB devices with your choice of virtualizer.
# Learn how to use Ledger with Debian inside VirtualBox.

Only after completing these steps, try to use Ledger in a {{project_name_short}} VM.

== Qubes R4 ==

The Qubes R4 USB widget formerly had bugs such as showing the USB device was connected to a VM while <code>qvm-usb</code> -- the command line authority whose judgment should be trusted more -- disagreed or showed the same USB device more than once in the menu. <ref>
[https://github.com/QubesOS/qubes-issues/issues/3266 USB devices shown multiple times in devices popup menu #3266]
</ref>

If similar issues re-emerge, follow these steps.

{{Box|text=
'''1.''' Physically connect the Ledger hardware wallet to a USB port.<br />
'''2.''' Run the following command to get an overview of USB devices detected by Qubes.

{{CodeSelect|code=
qvm-usb
}}

'''3.''' Check the output is similar to the following.

<pre>
BACKEND:DEVID  DESCRIPTION               USED BY
sys-usb:2-1.1  Logitech_USB_Keyboard
sys-usb:2-1.2  PixArt_USB_Optical_Mouse
sys-usb:2-1.4  Ledger_Nano_S_0001
</pre>

'''4.''' Use the following command to connect the Ledger hardware wallet to the preferred VM.

Replace <code>ledger-debian</code> with the actual name of the VM.

{{CodeSelect|code=
qvm-usb attach ledger-debian sys-usb:2-1.4
}}

'''5.''' Done.

The Ledger hardware wallet was attached to the selected VM using <code>qvm-usb</code>.
}}

See also: [[Dev/Ledger Hardware Wallet]].

= Issues =
* [https://github.com/LedgerHQ/ledger-live-desktop/issues/3672 publish firmware hashes of the unsecured chip on Ledger Nano X]

= Forum Discussion =
* general: https://forums.whonix.org/t/ledger-nano-s-support/8521/2
* KVM-specific: https://forums.whonix.org/t/ledger-nano-s-no-device-found/10934

= Donations =
After setting up a hardware wallet, please consider making a [[Donate|donation]] to {{project_name_short}} to keep it running for many years to come.

{{Pay_Bitcoin_Specific}}

{{Pay_Monero_Specific}}

= Footnotes =
{{reflist|close=1}}

{{Footer}}

[[Category:Documentation]]