{{Header}} __FORCETOC__
{{title|title=
Keyboard Layout
}}
{{#seo:
|description=How to change the Keyboard Layout in {{project_name_long}}.
|image=Keyboardlayout1282268640.jpg
}}
<div class="mininav">
* [[Language]]
* [[Keyboard Layout]]
</div>
[[File:Keyboardlayout1282268640.jpg|thumb]]
{{intro|
This wiki page provides information on keyboard layouts and how to configure them in {{project_name_short}}.
}}
= {{non_q_project_name_short}} =
== Desktop Environment ==
Kicksecure 18 and above.

System-wide configuration.

{| class="wikitable"
|+ ''System-wide Keyboard Layout Change for GUI (labwc) and virtual terminal (CLI)''

|-
! '''Platform'''
! '''Steps'''
|-

! System-wide - TUI
|
<u>{{tui}}</u>

Interactive:

{{CodeSelect|code=
sudo set-system-keymap --interactive
}}
|-

! System-wide - CLI
|
<u>{{cli}}</u>

View available keymaps.

{{CodeSelect|code=
localectl list-x11-keymap-layouts
}}

<u>Syntax:</u>

<pre>
sudo set-system-keymap keymap
</pre>

<u>Example:</u>

<u>Note:</u> Replace <code>de</code> with the actual keymap to use.

{{CodeSelect|code=
sudo set-system-keymap de
}}

<u>Manually:</u> See below.
|-

! scope="row" | Other Wayland compositors
| Differs depending on the Wayland compositor in use. Usually can be set using DE-specific tools, may require editing a configuration file and then restarting the compositor to make changes take effect.
|-

|}

Per-user configuration. (Not system-wide configuration.)

{| class="wikitable"
|+ ''Desktop Keyboard Layout Change''

|-
! '''Platform'''
! '''Steps'''
|-

! LXQt + labwc Wayland compositor - TUI
|
<u>{{tui}}</u>

Interactive:

{{CodeSelect|code=
set-labwc-keymap --interactive
}}
|-

! LXQt + labwc Wayland compositor - CLI
|
<u>{{cli}}</u>

View available keymaps.

{{CodeSelect|code=
localectl list-x11-keymap-layouts
}}

<u>Syntax:</u>

<pre>
set-labwc-keymap keymap
</pre>

<u>Example:</u>

<u>Note:</u> Replace <code>de</code> with the actual keymap to use.

{{CodeSelect|code=
set-labwc-keymap de
}}

<u>Manually:</u> See footnote. <ref>
<code>labwc</code> uses the <code>XKB_DEFAULT_LAYOUT</code> environment variable, as documented at https://labwc.github.io/getting-started.html.

To permanently change the keyboard layout, apply the following steps.

* Open a terminal &rarr; Run <code>mkdir -p ~/.config/labwc</code> &rarr; Run <code>nano ~/.config/labwc/environment</code> &rarr; Type <code>XKB_DEFAULT_LAYOUT=zz</code>, replacing <code>zz</code> with the code for your keyboard layout &rarr; Type <code>Ctrl+S</code> to save, then <code>Ctrl+X</code> to exit &rarr; Run <code>labwc --reconfigure</code> to load new settings.
</ref>
|-

! scope="row" | Other Wayland compositors
| Differs depending on the Wayland compositor in use. Usually can be set using DE-specific tools, may require editing a configuration file and then restarting the compositor to make changes take effect.
|-

|}

=== Multiple Keyboard Layouts ===
You can configure multiple keyboard layouts at the same time, and switch between them with a keyboard shortcut. <ref>https://forums.kicksecure.com/t/transfer-kicksecure-to-another-computer-cant-see-grub/1382/5</ref> A maximum of four keyboard layouts can be configured simultaneously.

'''1.''' Open a terminal.

'''2.''' Run <code>set-system-keymap</code> or <code>set-labwc-keymap</code> with the <code>--interactive</code> option.

'''3.''' When prompted to enter the keyboard layouts to use, input a comma-separated list of layouts. For instance, to use US English and German keyboard layouts, type <code>us,de</code>, then press <code>Enter</code>.

'''4.''' When prompted to enter keyboard layout variants, press Enter to use the default layout variants. <ref>
If you need non-standard keyboard layout variants, you may enter them here. You must specify the same number of layouts and layout variants. The layouts must be comma-separated. For instance, if you are using the layouts <code>us,de</code>, and want to use the Colemak layout for the US keyboard and the Dvorak layout for the German keyboard, specify <code>colemak,dvorak</code> as the variants.<br />
<br />
If you need to use a default keyboard layout for a variant, you may omit the variant from the list. However, you must type any commas that would have been present otherwise. For instance, to use the Colemak layout for the US keyboard, and the default layout for the German keyboard, specify <code>colemak,</code> as the variants. To use the default layout for the US keyboard, and the Dvorak layout for the German keyboard, specify <code>,dvorak</code> as the variants.
</ref>

'''5.''' When prompted to enter keyboard layout options, type <code>grp:alt_shift_toggle</code>, then press <code>Enter</code>.

'''6.''' Done.

You can now press <code>Alt + Shift</code> to switch between the selected keyboard layouts.

=== Changing the system or console keymap when using Full Disk Encryption ===
Special care must be taken when changing the console keyboard layout if you are using full disk encryption. Failure to follow these instructions may result in an unbootable system!

The disk decryption prompt is displayed during early boot. The keyboard layout used by the decryption prompt is hardcoded into the "initramfs", a small filesystem used as part of the boot process to prepare the real OS for startup. In order to decrypt the OS's primary disk, the keyboard layout used by the initramfs must allow the user to type all characters that make up the passphrase. The initramfs is occasionally regenerated so that system updates apply to it. When this occurs, the current console keyboard layout is embedded in the initramfs, and becomes the keyboard layout used at the disk decryption prompt.

This means that, if you change your keyboard layout to one that doesn't allow typing all characters that are part of your passphrase, the system will become unbootable the next time the initramfs is generated. For instance, if you were using a German keyboard layout, and included a <code>ß</code> or <code>§</code> character in the passphrase, the system will become unbootable if the keyboard layout is switched to US English and the initramfs is regenerated. This is because the US English keyboard layout is not able to type the <code>ß</code> and <code>§</code> characters.

<code>set-system-keymap</code> regenerates the initramfs as part of the keyboard layout change process. This will result in a system lockout on the next reboot if the above scenario occurs. <code>set-console-keymap</code> does not regenerate the initramfs, so it may not immediately cause a system lockout. However, software updates will automatically regenerate the initramfs frequently, so a system lockout will likely occur after the next software update if care is not taken.

Note that if the new keyboard layout is capable of typing all characters that are part of the disk passphrase, there is no risk of lockout. One will simply have to type their passphrase using the new keyboard layout rather than the old one.

If you need to change your keyboard layout, and the new layout is incompatible with your disk passphrase, you will have to change the disk passphrase to be compatible with the new disk layout. To do this '''on GUI systems''':

'''1.''' Open two terminal windows, and place them side-by-side on the desktop.

'''2.''' In one window, run:

{{CodeSelect|code=
sudo crypt-pwchange
}}

'''3.''' When prompted to choose a device to change the passphrase of, choose the device the root filesystem (<code>/</code>) is mounted from. You can use <code>lsblk</code> to determine which device is mounted at <code>/</code>.

'''4.''' When prompted for the existing passphrase, click the ''other'' terminal window, and run:

{{CodeSelect|code=
set-labwc-keymap --no-persist OLD_KEYMAP
}}

Replace <code>OLD_KEYMAP</code> with the keyboard layout the existing disk passphrase can be typed in. This will ensure your graphical session's keyboard layout is appropriate for typing the existing passphrase.

'''5.''' Click the terminal window where <code>crypt-pwchange</code> is running, and type the existing disk passphrase.

'''6.''' When prompted for the new passphrase, click the ''other'' terminal window again, and run:

{{CodeSelect|code=
set-labwc-keymap --no-persist NEW_KEYMAP
}}

Replace <code>NEW_KEYMAP</code> with the new keyboard layout you wish to use. This will ensure your graphical session's keyboard layout is appropriate for typing the new disk passphrase.

'''7.''' Click the terminal window where <code>crypt-pwchange</code> is running, and type the new disk passphrase.

'''8.''' Type the new disk passphrase again to confirm.

'''9.''' Click the ''other'' terminal window again, and run '''one''' of the following commands.

To change the system-wide keyboard layout:

{{CodeSelect|code=
sudo set-system-keymap NEW_KEYMAP
}}

To change only the console keymap:

{{CodeSelect|code=
sudo set-console-keymap NEW_KEYMAP && sudo dracut --regenerate-all --force
}}

Replace <code>NEW_KEYMAP</code> with the new keyboard layout you wish to use.

'''10.''' Done.

The process of changing the keyboard layout and disk passphrase is complete.

On CLI-only systems, you can use the same instructions as above using two virtual terminals instead of two terminal windows. Use <code>set-console-keymap KEYMAP</code> rather than <code>set-labwc-keymap --no-persist KEYMAP</code> to change the keyboard layout as needed during the process.

== Virtual Terminal ==
{{Anchor|Terminal}}

To change the <u>keyboard layout</u>.

<u>Note:</u> Changes keyboard layout for virtual terminals only. This does not effect the graphical environment. <ref>
Manually:

{{CodeSelect|code=
sudo dpkg-reconfigure keyboard-configuration && sudo setupcon
}}
<br />
French keyboards:
<br />
Perhaps an upstream bug. May no longer be applicable.
<br />
( https://web.archive.org/web/20160519163403/https://free.nchc.org.tw/clonezilla-live/stable/Known-issues-Clonezilla-live.txt )
<br />
If you are using French Keymap, remember to use "Select keymap from full list":
<br />
1. Select keymap from full list
<br />
2. pc / azerty / French / Same as X11 (latin 9) /Standard
</ref>

* {{CodeSelect|code=
sudo set-console-keymap
}}
* or:
* {{CodeSelect|code=
sudo set-system-keymap
}}

<ref>
Alternative <code>/etc/default/keyboard</code> method: <br />

{{Open with root rights|filename=
/etc/default/keyboard
}}
</ref> <ref>
Alternative <code>loadkeys</code> method: <br />

Temporary until reboot.

{{CodeSelect|code=
sudo loadkeys de
}}
</ref>

{{CodeSelect|code=
sudo set-console-keymap
}}

== Simple ==
<code>set-system-keymap</code> sets both keyboard layouts for,

* 1) {{cli}}, <u>and</u>
* 2) {{gui}}.

With 1 command only. It can either be started from

* A) [[System Maintenance Panel]], <u>or</u>
* B) from the command line.

{{tui}}:

{{CodeSelect|code=
sudo set-system-keymap --interactive
}}

CLI:

{{CodeSelect|code=
sudo set-system-keymap
}}

If installing {{project_name_long}} using its [[ISO]], {{project_name_long}}'s Calamares based installer) uses <code>set-system-keymap</code> internally to configure the keyboard layout.

= {{q_project_name_short}} =

To correctly apply changes system-wide via <code>dom0</code>: <ref>
The Qubes bug reporting [https://github.com/QubesOS/qubes-issues/issues/1396 the change does not propagate to other VMs] has now been resolved.
</ref>

* <code>System Tools</code> &rarr; <code>Keyboard</code> &rarr; <code>Layout</code>

Alternatively, [https://github.com/Qubes-Community/Contents/blob/master/docs/customization/language-localization.md language localization input] can be configured on a per VM basis.

If problems are encountered, see: [https://www.qubes-os.org/faq/#my-keyboard-layout-settings-are-not-behaving-correctly-what-should-i-do My keyboard layout settings are not behaving correctly. What should I do?] in the Qubes FAQ.

= See Also =
* [[Language|Change the System or Firefox Language]]

= Footnotes =
{{reflist|close=1}}

{{Footer}}

[[Category:Documentation]]