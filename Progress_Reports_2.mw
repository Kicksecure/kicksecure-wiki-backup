{{Header}}
{{title|title=
Progress Reports 2
}}
{{#seo:
|description=Overview on the continuous progress for Kicksecure (and Whonix) with individual specific contributions for content, research, implementation etc
|image=Page-progress-reports-thumb.jpg
}}
{{devwiki}}
{{about_mininav}}
<div class="mininav">
* [[#arraybolt3|arraybolt3]]
* [[#Hans|Hans]]
* [[#nurmagoz|nurmagoz]]
</div>
[[File:Page-progress-reports-thumb.jpg|thumb|200px]]
{{intro|
On this page we give an overview on the continuous progress for Kicksecure (and Whonix) on the most active contributors.
}}

= arraybolt3 =
== 2025-12-08 ==
=== Update bridges in anon-connection-wizard ===
Date: 2025-12-08

The list of bridges in anon-connection-wizard was out-of-date and wasn't working right. Updated the list with the latest list from the Tor Project's tor-browser repository.

=== Review, improve and fix some problems with keyboard layout set scripts ===
Date: 2025-12-08

Looked at Patrick's recent work on set-keyboard-layout.sh in helper-scripts. Fixed some issues, consolidated some redundant code, and ensured both the Kicksecure ISO and Kicksecure KVM image built properly and had GRUB keyboard layouts available.

=== Make package installation in sysmaint-panel more reliable, file lxqt-archiver bug report ===
Date: 2025-12-08

The package installation process now updates apt lists if a package can't be found initially. It also lowercases the package name, since all packages in the Debian archives use all-lowercase names and this avoids problems if users type names that contain capital letters.

Also filed a bug report against lxqt-archiver, which is unable to open RAR files in Trixie.

== 2025-12-07 ==
=== Start review of merged tor-control-panel / anon-connection-wizard ===
Date: 2025-12-07

Started reading through the new code from troubador. Will make modifications as needed to get it working right.

=== Investigate application installation difficulty, mis-reporting of FDE ===
Date: 2025-12-07

Researched a couple of bug reports from the forums, fixed one of the bugs, and commented on a possible solution for another issue (which wasn't really a bug but was more of a usability issue).

=== Finish integrating Hyper-V disable scripts into Whonix-Installer ===
Date: 2025-12-07

Fixed UI issues, script issues, and code issues. The application now builds without problems on Debian Trixie, and the installer can disable (or partially re-enable) Hyper-V as desired.

=== Look at issues with dpkg-new files in /etc/grub.d ===
Date: 2025-12-07

Patrick noticed that it was possible to end up with a <code>.dpkg-new</code> file stuck in /etc/grub.d. This looks like it might be problematic. More discussion needed to determine if this is a problem.

=== Add stuck process checker to usability-misc ===
Date: 2025-12-07

There is now a systemd service in usability-misc that, when enabled, will report if processes under <code>user.slice</code> are stuck during shutdown, and if so, which ones.

=== Review, update wiki pages on immutability ===
Date: 2025-12-07

Used some already-referenced material and 3mdeb's research into immutable distributions to make our wiki pages more correct. (In particular, grub-live is not an immutable boot mode, but a stateless boot mode.)

=== Discuss how to fix Tor Browser automatic update reliability ===
Date: 2025-12-07

Commented on a Qubes OS bug report about Tor Browser automatic updates, trying to figure out how to allow automatic updates to work in a secure fashion that requires less human intervention.

=== More polish on unicode-show and related tools ===
Date: 2025-12-07

Fixed the return value of unicode-show when a Unicode decode error is found (I mistakenly thought ChatGPT changed this incorrectly, when it was actually correct), and made unicode-show, sanitize-string, strip-markup, and the stdisplay family of tools not directly executable via /usr/lib/python3/dist-packages, to avoid inconsistent behavior. (Users should call these using their wrapper scripts in /usr/bin.)

== 2025-12-06 ==
=== Finish regression tests for unicode-show ===
Date: 2025-12-06

ChatGPT Codex created a test suite for unicode-show. It looked useful, but did not work the way most of our other tests work. Wrote a full test suite using ChatGPT's example code as a guide, and ensured it passed as expected.

== 2025-12-05 ==
=== Work on fixing carriage return concerns in helper-scripts sanitize-string and stdisplay ===
Date: 2025-12-05

We've decided to treat carriage returns as potentially malicious in stdisplay and related utilities. Did a lot of the work needed to make these changes work and make working regression tests for them.

=== Research creation of a debug helper unit for shutdown ===
Date: 2025-12-05

We'd like to create a systemd unit that triggers on shutdown and outputs information about still-running processes and units once per second until all processes but itself have terminated. Did some research to figure out if this was feasible, and how to do it without stalling shutdown for an unreasonably long time.

== 2025-12-04 ==
=== Fix sdwdate-gui-qubes-proxy stuck in "activating" state ===
Date: 2025-12-04

When sys-whonix was powered off but anon-whonix was on, anon-whonix had an sdwdate-gui-qubes@.service unit stuck "activating" until sys-whonix was powered back on. This caused issues in systemcheck. Found the root cause of this and fixed it.

=== Continued Codex PR review ===
Date: 2025-12-04

Merged more changes to helper-scripts and security-misc. Discussed some aspects of the changes with Patrick.

== 2025-12-03 ==
=== More Codex PR review ===
Date: 2025-12-03

Still working through PRs mostly to helper-scripts. Was able to merge in several changes.

=== Simplify whonix-firewall restarter with systemd settings ===
Date: 2025-12-03

The enhancements to the restarter script from ChatGPT ended up being superfluous because of the systemd unit configuration on firewall-restarter. Reverted the changes, and added <code>PrivateTmp=true</code> to the unit to clean up fifos.

== 2025-12-02 ==
=== Continued Codex PR review ===
Date: 2025-12-02

Reviewed and merged in the useful parts of additional Codex PRs. This notably included additional test enhancement for stdisplay, and a resource consumption optimization for sttee.

=== Add additional defense-in-depth measures to sanitize_string ===
Date: 2025-12-02

ChatGPT warned that there was the possibility of unsanitized ANSI escape codes being printed by sanitize_string if a malicious string contained ESC characters encoded as HTML entities. This did not appear to be a real concern (such entities were simply stripped by markup stripping rather than being translated), but just in case this behavior changed in the future, or a workaround for embedding ESC characters into HTML exists, there is now an extra stdisplay call to sanitize ANSI codes after markup stripping.

=== Fix broken screen unlock caused by block-unsafe-logins ===
Date: 2025-12-02

swaylock runs the PAM stack as a non-root user, which broke block-unsafe-logins and made it think every user account was passwordless. Fixed this by adding a privleap call to block-unsafe-logins for getting password status information.

== 2025-12-01 ==
=== Start reviewing more Codex PRs ===
Date: 2025-12-01

Patrick ran more of our software through ChatGPT Codex, which made several more PRs. Started reviewing those, merging in code where appropriate.

=== Silence SRSO warning in virtual machines and containers, advise what to do about watchdog timeouts ===
Date: 2025-12-01

Patrick noted that there were strange watchdog timeouts happening after massive time jumps, and very long CPU soft lockups in a swap-related kernel thread. Mentioned that this looked to be either hardware- or configuration-related. Also silenced SRSO warnings in virtual machines since they do not appear to be entirely fixable there.

=== Make set-system-keymap also set the GRUB keymap ===
Date: 2025-12-01

Setting the system keymap with <code>set-system-keymap</code> will also configure GRUB to offer the chosen keyboard layout in the boot menu now.

=== Fix tor-ctrl end-of-options, add to Kicksecure by default ===
Date: 2025-12-01

tor-ctrl's argument parser was subtly broken such that the end-of-options indicator was being incorrectly parsed. Fixed this, and also added tor-ctrl to dist-general-cli so it would be installed on Kicksecure as well.

=== Final test and code approval on DispVM PR for qubes-core-admin-addon-whonix ===
Date: 2025-12-01

The code appears to be working correctly. Approved the PR and posted the test results.

=== Work new sanitize-string and strip-markup commands into codebase, expand tests ===
Date: 2025-12-01

Added some more tests for sanitize-string to test the string truncation feature. Modified the entire codebase to use the new API for sanitize-string and strip-markup where appropriate.

=== File bug report for Qubes Salt issues with anon-whonix.sls ===
Date: 2025-12-01

Filed a bug on the Qubes OS bug tracker with all info about <code>qubesctl</code> failing to create default Whonix virtual machines even with necessary templates preinstalled.

== 2025-11-30 ==
=== Add tests for strip_markup and sanitize_string, add to helper-scripts test suite ===
Date: 2025-11-30

Wrote working tests for strip_markup and sanitize_string. Found and fixed a bug in sanitize_string in the process. Still need to work new APIs for strip_markup and sanitize_string into the codebase.

=== Add notification to sysmaint qrexec action blocker ===
Date: 2025-11-30

user-sysmaint-split's qrexec action blocker now creates a desktop notification when an action is blocked, helping to reduce user confusion.

=== More debugging missing boot menu options after upgrading standalone Whonix-Workstation from Whonix 17 to 18 ===
Date: 2025-11-30

Issue currently appears to be an upgrade bug when using a Whonix standalone that originally did not have user-sysmaint-split installed. More research needed.

=== Finish testing of DispVM PR for qubes-core-admin-addon-whonix from Ben ===
Date: 2025-11-30

Tested a modified version of the PR, seems to work acceptably well. Published my modifications, Ben merged them.

=== Attempt to debug Whonix Salt formula failure on Qubes R4.3 ===
Date: 2025-11-30

Looked at the code for the salt formulas, tested on a couple of different machines, and investigated some of the commands involved in the process. Was not able to determine why the Salt formula is failing. Will file a bug report with Qubes later.

== 2025-11-29 ==
=== Review security-misc PRs from raja-grewal ===
Date: 2025-11-29

Merged in several more PRs, commented on those that could not be merged yet.

=== Re-review, attempt to test ben-grande's DispVM/NetVM config pr to qubes-core-admin-addon-whonix ===
Date: 2025-11-29

Found some possible bugs in the PR and some pre-existing bugs that would interfere with the PR's goals but weren't in the PR itself. Made some fixes, reported the issues as another review. Attempted to test a modified version of the PR, but got stuck because Salt did not allow me to regenerate the Whonix VMs the way I expected.

=== Rebuild Whonix-LXQt 18 image for tb-updater testing ===
Date: 2025-11-29

Built the Whonix 18 images for VirtualBox from scratch to ensure that Tor Browser was installed properly in the workstation during the build process.

=== Further enhance the workaround for the LXQt black desktop background bug ===
Date: 2025-11-29

A completely empty <code>~/.config/pcmanfm-qt/lxqt</code> directory was able to trigger the same bug. Added code for detecting and removing this directory if empty.

== 2025-11-28 ==
=== Use the hardcoded Tor Browser version in tb-updater as a verification mechanism rather than a locking mechanism ===
Date: 2025-11-28

Changed the tb-updater code a bit so that newer versions of tb-updater could be downloaded during image builds even if the hardcoded version was out of date.

=== Attempt to debug boot menu entries not appearing in Whonix-Workstation 18 standalone VM ===
Date: 2025-11-28

Was unable to reproduce the problem by making a standalone from an existing template. Found the corresponding bug report on the Qubes OS issue tracker and found out this was an upgrade issue, suggested that perhaps user-sysmaint-split needed to be installed.

== 2025-11-27 ==
=== Start reviewing several security-misc PRs from raja-grewal ===
Date: 2025-11-27

raja-grewal made several PRs against security-misc that were in need of review. Started going through them, commenting on them and merging some of them in.

=== Investigate suspend failure with Kicksecure 18 ===
Date: 2025-11-27

Could not reproduce the exact issue, but it may be caused by <code>panic_on_warn</code>, which caused problems on my current testing machine.

=== Find root cause of network settings issue on Qubes HVMs, document fix and how to avoid ===
Date: 2025-11-27

The user who reported the network settings issue with Qubes HVMs was disabling "All users may connect to this network". I was able to reproduce the issue when doing this. Documented that this should not be done, what the results of doing it are, and how to undo it.

== 2025-11-26 ==
=== Investigate network settings not carrying over from sysmaint to user mode ===
Date: 2025-11-26

Was not able to reproduce the issue; network configuration done in user mode was visible in sysmaint mode and vice-versa.

=== Make leapctl and leaprun poll for the appropriate privleapd socket before giving up ===
Date: 2025-11-26

Patrick discovered he could cause leaprun to error out unexpectedly by running <code>sudo systemctl restart privleapd.service; leaprun ...</code>. Discussed possible solutions, ended up implementing simple polling for the appropriate sockets.

=== Update kloak documentation on Whonix wiki ===
Date: 2026-11-26

Read through existing kloak documentation, updated the docs in several areas.

=== Finish kloak Tor Browser scrolling fix ===
Date: 2025-11-26

The reworked scroll event handling appears to be working well with multiple types of scrolling devices (standard mice, an MX Master 3S, vertical and horizontal two-finger scrolling on a touchpad, and KVM's mouse input). Didn't find any memory safety issues, did find and fix a problem with unexpected libinput events thwarting the anonymization of scroll events. Merged to arraybolt3/trixie branch and posted an update on the Whonix forums.

== 2025-11-25 ==
=== Rework scroll handling in kloak ===
Date: 2025-11-25

The original way scroll events were handled turned out to not work with Tor Browser or Firefox, and was less anonymous than it could be. Reworked the scrolling mechanism to work with Tor Browser, and made scroll handling more anonymous as a side effect.

== 2025-11-24 ==
=== Continue Whonix-Installer Hyper-V disable work ===
Date: 2025-11-24

The logic seems to be mostly right at this point. There are some strange UI issues that need sorted out still.

=== Review, integrate whonix-firewall changes suggested by ChatGPT Codex ===
Date: 2025-11-24

Patrick had Codex look at whonix-firewall. It suggested some fixes and enhancements, many of which looked valuable though most of them needed changes to be suitable for inclusion. Reviewed, studied, and integrated the suggestions as appropriate.

== 2025-11-23 ==
=== Start adding Hyper-V disable functionality to Whonix-Installer ===
Date: 2025-11-23

A lot of the refactoring needed to disable Hyper-V in Whonix-Installer is now done. I'm also adding enhanced error handling to some of the code since it does not look particularly safe in its current state.

=== Debug, fix pkexec SUID bit not being restored when user-sysmaint-split is uninstalled ===
Date: 2025-11-23

Due to an unfortunate interaction between permission-hardener's first-run timing and pkexec's postinst script, the permissions on /usr/bin/pkexec were 755 (no SUID bit) when permission-hardener first locked it, resulting in the incorrect permissions being restored later. After discussion with Patrick, I fixed this by making security-misc's postinst install a "good" initial state during the package's installation, and also added a str_replace call for fixing the permission database on upgrade.

=== Make sdwdate-gui-qubes@.service a notify unit ===
Date: 2025-11-23

Using a oneshot unit here meant that the unit always showed as starting when it was likely not going to ever terminate. Switched to <code>Type-notify</code> and added a systemd-notify call to remedy this.

== 2025-11-22 ==
=== Silence more journal warnings in systemcheck for Whonix on VBox and Qubes ===
Date: 2025-11-22

Looked at both Whonix-Gateway and Whonix-Workstation on VirtualBox and Qubes, found ignorable journal warnings, and added them to the ignore list.

=== Debug, fix power management config override in lxqt-powermanagement ===
Date: 2025-11-22

lxqt-powermanagement was overriding system-wide configuration with user-specific configuration because the system-wide configuration didn't declare that lxqt-powermanagement was already configured. Determined what option needed to be set to fix this, and set it. Suggested a way to fix the configuration for existing Kicksecure/Whonix 18 users.

=== Silence spurious sdwdate-gui-qubes-proxy systemd unit failures in Kicksecure-based sys-net ===
Date: 2025-11-22

sys-net starts before sys-whonix, thus sdwdate-gui has no way of reporting its status to sys-whonix upon initial boot. Changed an <code>exit 1</code> to an <code>exit 0</code> to resolve this. Also noticed an issue with Tor status reporting and fixed it while I was working on this.

=== Document boot menu theme disappearing when serial-console-enable is installed ===
Date: 2025-11-22

Reproduced the boot menu theme issue on my end, documented it on the recovery wiki page (which is where we tell users to install serial-console-enable).

=== Test usbguard accept/reject prompts in in Kicksecure-based sys-usb ===
Date: 2025-11-22

Patrick added "modify" permissions to our usbguard IPC configuration. Tested and verified that the usbguard-notifier prompts now allowed accepting or rejecting USB devices when Kicksecure was used as sys-usb.

=== Finish debugging Kicksecure ISO HVM issues, create bug reports ===
Date: 2025-11-22

Determined why the virtual VGA adapter used for HVMs was not working with labwc (too little VRAM turned out to be the culprit). Also did testing to see what was happening with resolutions like 1366x768 and determine whether it was a Qubes issue, QEMU issue, or labwc issue. Reported bugs to Qubes OS.

=== Review, test replace-ips after refactor ===
Date: 2025-11-22

Patrick substantially refactored the replace-ips script and asked me to review and test. Looked through it, made some minor changes, and tested it. It appeared to work properly on my R4.3 machine.

== 2025-11-21 ==
=== Debug, fix unnecessary Tor restarts during early boot under Qubes OS ===
Date: 2025-11-21

Patrick noticed that Tor was failing to start when sys-whonix first booted under Qubes, and ended up restarting. Cooperatively figured out why, found a solution, and implemented it.

== 2025-11-20 ==
=== More work on optimizing Whonix bootup, audit mkdir calls in an attempt to fix /tmp/user/100* ownership bug ===
Date: 2025-11-20

Found some ways to speed up service startup for some of our sdwdate-related systemd units, and applied those optimizations. Also audited all mkdir calls in Kicksecure and Whonix to see if any of them were at risk of creating /tmp/user/1000 (or similar directories) owned by root. Found one possible mkdir issue, and made a fix for it.

=== Silence red XDG_RUNTIME_DIR error from labwc ===
Date: 2025-11-20

After some more research, decided that the error was benign and could be safely hidden. Added code to do this to desktop-config-dist and systemcheck.

=== Fix sdwdate-gui flashing menu and busy-wait bugs ===
Date: 2025-11-20

The new asyncio version of sdwdate_gui_client was sending too-frequent Tor update messages during a Tor restart, and would consume 100% CPU if the sdwdate-gui.ConnectCheck qrexec call failed. Fixed both bugs.

== 2025-11-19 ==
=== Debug, work around Qubes OS Kicksecure ISO boot failure ===
Date: 2025-11-19

Determined that the reason the Kicksecure ISO was booting to a black screen under Qubes OS was because of wlr_resize_watcher attempting to set the display resolution to 1920x1080 (labwc does not work with this resolution with the emulated graphics in Xen). Modified wlr_resize_watcher to use a resolution of 1024x768 under Xen.

=== Debug, work around BTRFS live mode breakage ===
Date: 2025-11-19

Due to a bug in Debian's version of Dracut, using rd.live.overlay.overlayfs for live mode failed on BTRFS (the filesystem would end up read-only with no overlay). Reported the bug to Debian and switched back to Debian's "rootovl" parameter for the time being. (Unfortunately even this parameter has a cosmetic issue with BTRFS, but functionally it works.)

=== Verify last bug mentioned in privleap AI review task was fixed ===
Date: 2025-11-19

Patrick mentioned another bug related to non-ideal signal handling in leaprun. Looked at and tested the code, verified that the issue no longer occurred in normal use.

=== Add black desktop fix code to desktop-config-dist ===
Date: 2025-11-19

The previous bugfix for the black desktop issue only prevented it from happening, it didn't fix it after it already happened. Added more code to desktop-config-dist that fixes it after it happens.

== 2025-11-18 ==
=== Add systemcheck rule to silence a new benign warning under Qubes OS ===
Date: 2025-11-18

A Qubes OS PR causes the in-domU notification proxy to start earlier, resulting in a small amount of benign log spam that was showing up in systemcheck. Added a new journal ignore rule to silence it.

=== Fix broken passwordless sudo in unrestricted admin mode ===
Date: 2025-11-18

Our new PAM-based user locking mechanism in security-misc was accidentally keeping people from using passwordless sudo if they removed user-sysmaint-split. Added some code to the locking mechanism to bail if user-sysmaint-split is not installed.

=== Review, integrate more suggested fixes to privleap from ChatGPT Codex ===
Date: 2025-11-18

Codex suggested some more useful improvements to privleap, such as dropping supplemental groups (critical, only wasn't a security hole because systemd didn't set any supplementary groups on privleapd) and checking the ownership and mode of the privleap configuration directory and files under it. Applied those enhancements.

=== Improve termination signal handling in leaprun ===
Date: 2025-11-18

Hitting Ctrl+C while leaprun is actively streaming stdio from a privleap action could sometimes cause leaprun to exit improperly rather than sending an action termination message to privleapd. Improved the signal handler mechanism to fix this.

=== Diagnose, fix trigger of black desktop issue with LXQt ===
Date: 2025-11-18

LXQt has a bug of sorts where shutting down the system from the CLI using the reboot or shutdown commands will cause various settings in pcmanfm-qt being set to bad defaults, if the system has never been shut down from within a user session before. This turned out to be the result of a stray lockfile pcmanfm-qt was leaving on the disk. Added code to our desktop launch routine to detect and remove this lockfile during login.

== 2025-11-17 ==
=== Finish fixing qubes-video-companion on Whonix-Workstation 18, work on optimizing Whonix ===
Date: 2025-11-17

qubes-video-companion now works normally on Whonix, awaiting PR merge. There are some warnings from systemcheck that appear likely unrelated to qubes-video-companion that need to be looked at though.

Most of the remaining issues with Whonix tests failing on Qubes OS appear to be the result of Whonix generally being too slow to boot. Did some research into how to optimize our code's performance, especially at boot time.

=== Fix theming of keyboard layout selector in ISO GRUB menu ===
Date: 2025-11-17

Determined why the theming was broken and fixed it. Built a new Kicksecure 18 ISO, the theming looks good now.

== 2025-11-16 ==
=== More work on diagnosing performance issues under Qubes OS, start work on adding privleap rules to qubes-video-companion ===
Date: 2025-11-16

Discovered that VMs other than Whonix were suffering occasional performance issues on Qubes, but that Whonix was the only one tripping timeouts. Got a privleap rule added to qubes-video-companion, but was not yet able to test it due to a problem with qubes-builderv2 and building Debian packages.

=== Integrate security fixes and hardening for privleap from ChatGPT Codex ===
Date: 2025-11-16

Patrick ran privleap through Codex, which found a number of minor security issues in it (all of which were unlikely to cause problems with the way we use privleap in Kicksecure and Whonix). Integrated fixes and regression tests for those fixes into privleap, and ensured all regression tests passed.

== 2025-11-15 ==
=== Benchmark some of Kicksecure's performance issues under Qubes OS ===
Date: 2025-11-15

So far I've been unable to reproduce many of the memory and timeout issues being experienced in Qubes' OpenQA tests. Benchmarking shows some slowed performance, but this appears to be mostly caused by our myriad of systemd units for various hardening tasks, and it's unclear if it's possible or easy to fix this. I couldn't reproduce major issues that would be likely to cause test failures, so I will need to investigate the individual failing tests closer and possibly run the test system locally to try and reproduce.

=== Fix Kicksecure VM image build failure caused by wiped /etc/hostname ===
Date: 2025-11-15

Discovered that when the builder's hostname is <code>localhost</code>, and the built image's hostname is also supposed to be <code>localhost</code>, the build system gets confused and runs <code>shred</code> on the built image's <code>/etc/hostname</code>. Added a check to see if the built image's <code>/etc/hostname</code> matches the intended build hostname, and avoid running <code>shred</code> if so.

== 2025-11-13 ==
=== Add username and UID information to authorization presence/absence notices in leaprun ===
Date: 2025-11-13

Made it so that when leaprun reports that a user is authorized or unauthorized to run a particular action, that they are told the exact username and UID that is authorized or unauthorized. Also did refactoring to make tests easier to work with.

=== Add GRUB keyboard layout configuration support ===
Date: 2025-11-13

Created scripts for building X keyboard layouts into GRUB layout, both at upgrade and image build time. Also integrated the needed features to get these on the ISO boot menu. This should make it easier for users to add custom kernel parameters frmo within GRUB.

== 2025-11-12 ==
=== Improve set-keyboard-layout.sh, research console and GRUB keyboard layout config ===
Date: 2025-11-12

Made it so that other options passed to the keyboard layout change scripts work even when used in combination with <code>--interactive</code>. Implemented initramfs regeneration for set-system-keymap. Changed set-labwc-keymap to persist settings by default and use <code>--no-persist</code> to suppress persistence. Researched whether it would be possible to set the console keymap without root permissions, and how to change the GRUB keymap.

=== swap-file-creator fixes, make livecheck-lsblk.service wait for systemd-tmpfiles ===
Date: 2025-11-12

Fixed some issues after merging in Patrick's changes to swap-file-creator, and made it easier to override the setting that refuses to create a swapfile on non-LUKS systems.

Added an ordering dependency to livecheck-lsblk.service to make it wait for systemd-tmpfiles.

=== Attempt to diagnose USB installation issues, cancel ticket for increasing non-qubes RAM ===
Date: 2025-11-12

A user on the Kicksecure forums reported problems attempting to install Kicksecure to USB drives. This appeared to be a mixture of Rufus behaving poorly and some timeouts being too short.

Now that we know that some of our RAM issues are caused by encrypted swap, we don't have to increase RAM requirements anymore.

== 2025-11-11 ==
=== Adjust swap-file-creator to use unencrypted swap, report bug with encrypted swapfiles ===
Date: 2025-11-11

Modified swap-file-creator to use unencrypted swapfiles, and added a substantial amount of code to it for ensuring that the underlying disk is a LUKS volume. Also verified that the encrypted swapfile lockups do occur with a mainline kernel, and reported the bug to the LKML.

=== Move sdwdate-gui config file migration code to sdwdate-gui postinst ===
Date: 2025-11-11

Moved the migration code from legacy-dist to sdwdate-gui, so that upgrades will go smoothly.

== 2025-11-10 ==
=== Begin debugging VM lockups with encrypted swapfiles ===
Date: 2025-11-10

I discovered that VMs were locking up due to RAM exhaustion before using anywhere near as much swap as was available when using an encrypted swapfile. Confirmed that encrypted swapfiles work on Bookworm, break on Trixie, and than unencrypted swapfiles (whether on or not on a LUKS volume) work as expected. Need to test swapfile behavior under Qubes OS and possibly report a kernel bug for this issue,

=== Fix passwordless login for sensitive accounts ===
Date: 2025-11-10

After some discussion, Patrick and I decided we should only prevent privilege escalation tools from authenticating sensitive passwordless accounts, and that login utilities like greetd, login, and sshd should be allowed to authenticate normally. I implemented this, it seems to work in testing.

=== Investigate Trixie startup/shutdown speed ===
Date: 2025-11-10

Both me and Patrick believed we noticed substantially slowed down shutdown after some recent code changes. I was unable to reproduce the issue however, when measuring time from a shutdown button click until VirtualBox reported "Powered off" using SimpleScreenRecorder and Friction.

=== Merge invalid data handling fixes for sdwdate-gui from ChatGPT Codex ===
Date: 2025-11-10

ChatGPT caught a couple of spots where invalid data could be handled in a less-than-ideal way and suggested good fixes for them. Merged in a modified version of those fixes.

== 2025-11-09 ==
=== Attempt to hide red XDG_RUNTIME_DIR error during shutdown ===
Date: 2025-11-09

Very rarely, something (looks like labwc) complains about XDG_RUNTIME_DIR not being set when it launches. Attempted to resolve this, however my first try failed. Most likely the labwc session started by greetd is the issue.

=== Hide network folder icon on LXQt desktop ===
Date: 2025-11-09

The network folder icon is unnecessary. Removed it from the PCManFM-Qt configuration.

=== Fix VISUAL environment variable not being set by usability-misc profile.d script ===
Date: 2025-11-09

The script checked to make sure it wasn't running in a TTY before changing the value of the VISUAL env var. This is no longer correct because the Wayland session itself runs in a TTY (or at least appears to). Removed the TTY check, now the variable is set correctly.

=== Install vm-config-dist on all Kicksecure and Whonix installations ===
Date: 2025-11-09

vm-config-dist is now able to be installed on all platforms, making ISOs work better on virtual machines and making physical-to-virtual and virtual-to-physical migrations theoretically easier. Moved it to the dist-general-cli metapackage.

=== Terminate VBoxDRMClient during shutdown ===
Date: 2025-11-09

Added code to security-misc that terminates VBoxDRMClient when the system is shut down. This fixes the /tmp unmount issue (which is already resolved upstream, we may be able to remove this code soon hopefully). At around this time I discovered my bug report against VirtualBox for this issue was a duplicate of an already solved issue.

=== Use PAM to enforce login control in lieu of password locks, simplify login security table ===
Date: 2025-11-09

Created a new script to use with pam_exec.so for preventing sysmaint login in user mode, non-sysmaint login in sysmaint session, and unsafe passwordless login. Simplified the login security table code since the PAM change made it no longer necessary to special-case the sysmaint account when looking at password status.

=== Refactor sdwdate-gui IPC data parsing and config file parsing code ===
Date: 2025-11-09

While applying a ChatGPT-created bugfix, I discovered that the config file parsing code was inconsistent, contained redundancies, and could be mostly replaced with tomllib. The IPC data parsing code was also inconsistent and contained redundancies. Refactored the code to unify multiple implementations of the same code, and rely on tomllib for most of the hard work of config file parsing.

=== Comment on application replacement suggestions on Whonix forum ===
Date: 2025-11-09

Suggested that we drop a PDF viewer in Whonix, in favor of the one built into Tor Browser. Also pointed out that the use of GNOME apps in Kicksecure and Whonix isn't much of a concern when it comes to number of additional dependencies installed, and mentioned that the use of Flameshot at the moment is because Screengrab doesn't work with Wayland in Debian Trixie. We will want to switch to Screengrab later.

== 2025-11-08 ==
=== Fix AppArmor issues in kloak, silence a spurious journal warning in systemcheck output ===
Date: 2025-11-08

Most of the warnings systemcheck printed from the journal on a Kicksecure 18 system turned out to be because of AppArmor configuration problems in kloak. Resolved those issues. Also silenced a weird "success" warning related to disk encryption coming from the audit logs.

=== Debug, file bug report for /tmp unmount failure caused by VBoxDRMClient ===
Date: 2025-11-08

Discovered that /tmp was failing to unmount at shutdown because of VBoxDRMClient. Filed a bug report (which turned out to be a duplicate despite having searched for bug reports first, because I failed to check closed reports).

=== Investigate fixing sgdisk warning about partition end alignment and disk encryption ===
Date: 2025-11-08

Discovered that the issue is a mismatch in how sgdisk and parted think partitions should be aligned. Sent an email to the GPT fdisk general mailing list to ask about what the best way of resolving this would be.

=== Make errors in sysmaint-boot more obvious ===
Date: 2025-11-08

Made it so that if sysmaint-boot errors out, the error messages it displays are printed to the console, and remain visible for five seconds before boot proceeds.

=== Hide virtual cursor image by default in kloak ===
Date: 2025-11-08

Changed the default cursor color in kloak from opaque red to fully transparent. Also added code to kloak to avoid drawing a virtual cursor at all (even a transparent one) if the cursor color is entirely transparent.

== 2025-11-07 ==
=== Apply more Qubes memory usage reduction changes ===
Date: 2025-11-07

Made usbguard not run when it doesn't have to. Suggested to Patrick that we merge in the changes to sdwdate-gui-client before the initial release of Kicksecure/Whonix 18.

=== Merge in ChatGPT Codex suggestions for live-hardener submount handling ===
Date: 2025-11-07

Codex caught a bug in live-hardener (still using plain prefix matching for detecting submounts, which is prone to false-positives). Merged in the fix and regression test enhancements.

== 2025-11-06 ==
=== Bugfix, improve live-hardener ===
Date: 2025-11-06

Found several issues with live-hardener (mainly related to attempting to overlay or remount filesystems that shouldn't be modified, and incorrectly handling submounts). Refactored the script substantially to fix these issues and improve regression test coverage.

=== Find and fix root cause of live mode failures ===
Date: 2025-11-06

Patrick and I determined that the live mode issues were caused by the <code>dmsquash-live</code> module not being included in the initramfs after the first time the initramfs is regenerated. Added configuration to grub-live to ensure that module is always included.

== 2025-11-05 ==
=== Continued debugging of live mode failures ===
Date: 2025-11-05

Researched how Dracut live mode internally, and discussed more possibilities for why things are breaking with Patrick. Still haven't discovered the root cause of the issue.

=== Create batch files for managing Hyper-V under Windows ===
Date: 2025-11-05

Fleshed out a script started yesterday that disables several Hyper-V related security features. Also fleshed out a companion script that re-enables several features that are powered by Hyper-V, and created a script that displays info related to Hyper-V-related feature configuration.

== 2025-11-04 ==
=== Investigate disabling Hyper-V under Windows ===
Date: 2025-11-04

Worked with Patrick to discover the steps needed to disable Hyper-V on Windows 11. This should allow VirtualBox to run at full speed.

=== Make it more obvious when a Qubes HVM doesn't have enough RAM to work with the Kicksecure ISO ===
Date: 2025-11-04

Bumped up the RAM limited in rads and adjusted how the low RAM message from rads is displayed so that users are more likely to notice it.

=== Test Kicksecure ISO for live mode issues ===
Date: 2025-11-04

Attempted to reproduce problems with live mode under Kicksecure on VirtualBox. Was not able to reproduce the problems, even when working with Patrick to figure out the root cause.

=== Test Whonix 18 for disk corruption on Manjaro ===
Date: 2025-11-04

Installed a pair of Whonix VMs in Manjaro using KVM. Was not able to reproduce the disk corruption issue with them. Documented a possible workaround for the issue on Whonix 17, considering the issue solved enough.

== 2025-11-03 ==
=== Debug Whonix disk corruption bug under Fedora and Manjaro, investigate Windows privilege elevation ===
Date: 2025-11-03

Was not able to reproduce the disk corruption issue on Fedora 42 KDE. Was able to reproduce the issue once on Manjaro KDE, but could not reliably reproduce it thereafter. Took some notes about the issue and left a suggestion for how to possibly work around it. Also researched how to handle user account control and privilege elevation under Windows so that Whonix-Installer can disable Hyper-V automatically during the installation.

=== More systemcheck gripe fixing under Qubes OS ===
Date: 2025-11-03

Discovered the root cause of one one of the systemcheck gripes (specifically the oen related to systemctl and D-Bus user bus access). Filed a bug report against Qubes OS for the issue.

== 2025-11-02 ==
=== policyrcd-script-zg2 feature request for drop-in config directory ===
Date: 2025-11-02

Asked the upstream developers of policyrcd-script-zg2 if they'd accept a drop-in config directory feature contribution.

=== Fix some systemcheck gripes under Qubes OS ===
Date: 2025-11-02

Patrick and Marek both were seeing some systemcheck messages that should not have been appearing. Fixed the root cause of several of them, silenced other false-positives. Haven't finished debugging all of them yet, but most of them are fixed.

=== Implement better power management defaults ===
Date: 2025-11-02

Added improved power management configuration to desktop-config-dist. The new configuration should be reasonably usable while providing better security than LXQt's default configuration (by virtue of locking the screen rather than suspending to avoid a race condition that could leave the screen unlocked).

=== Make Livecheck only show one information window at once ===
Date: 2025-11-02

A user could open a theoretically unlimited number of Livecheck windows at the same time previously. Added some code so that the user could not open a new Livecheck window until they closed the old one.

=== Reload labwc keyboard layout when using set-system-keymap ===
Date: 2025-11-02

Added code to the <code>set-keyboard-layout.sh</code> library that reloads labwc configuration after setting the system-wide keyboard layout.

=== Fix text encoding issue caused by improper locale setup on Kicksecure VM images ===
Date: 2025-11-02

Flatpak was outputting question marks in place of Unicode in some instances. Discovered this was because of improper locale configuration, determined why the locale was not being configured properly, and created a fix.

=== Fix sdwdate-gui issues when sys-whonix is booted in sysmaint session ===
Date: 2025-11-02

We were hardcoding a UID in the sdwdate-gui proxy helper script. Fixed this so that it determines the correct UID based on the value of the <code>/default-user</code> key in qubesdb. Also fixed an issue where the sdwdate-gui icon would get stuck on the wrong icon in some instances.

=== Reproduce, file bug report for LXQt sleep + screen locking issue ===
Date: 2025-11-02

Successfully reproduced the screen lock timing issue on Arch Linux, and filed a bug report about it. Turns out to be a race condition between putting the system to sleep and locking the screen.

=== Test new disallowed-test in systemcheck on a newly build Kicksecure KVM image ===
Date: 2025-11-02

Previously the AppArmor "disallowed-test" failed for me in a KVM virtual machine. Built a new VM from scratch, discovered that the issue does not occur there.

== 2025-11-01 ==
=== Try to reproduce LXQt sleep + screen locking issue on Arch ===
Date: 2025-11-01

On Kicksecure, LXQt would sometimes put the system into sleep before locking the screen all the way. Attempted but failed to reproduce the issue on Arch Linux, made some notes for future debugging.

=== Investigate user-sysmaint-split vs policyrcd-script-zg2 ===
Date: 2025-11-01

Looked at how policyrcd-script-zg2 works and how it interacts with user-sysmaint-split. Suggested that we remove it from our dependencies.

=== Document flatpak authorization hardening in security-misc ===
Date: 2025-11-01

Added documentation to the README about the Flatpak authorization hardening added to security-misc.

=== Make vm-config-dist installable on all platforms ===
Date: 2025-11-01

Removed some deprecated code from vm-config-dist, and added needed checks to make sure it could be installed on physical systems and virtual systems other than VBox and KVM. This should make it easier to move Kicksecure images between hypervisors, and allow us to ship vm-config-dist on the Kicksecure ISO to improve the experience for users who use the ISO in a virtual machine.

== 2025-10-31 ==
=== Research, start discussion on power management config for physical Kicksecure systems ===
Date: 2025-10-31

Went through all of the settings supported by LXQt for power management, documented advantages and disadvantages of each one from a security and usability perspective, and created a recommendation for settings we should use by default. Awaiting feedback from forums.

=== Investigate, harden Flatpak security rules for app installation and management ===
Date: 2025-10-31

Patrick discovered that one could install a Flatpak system-wide even when running in a user session and logged into account <code>user</code>. Discovered why this was the case, and implemented changes to Flatpak's configuration to prevent this and require authentication for most Flatpak-related operations.

=== Fix fakeroot-caused systemctl errors in dnf-3 uwt wrapper, silence unnecessary warnings ===
Date: 2025-10-31

alimj pointed out that the issue with Qubes updates showing "Operation not permitted" errors was because of fakeroot. Determined that it was possible to use <code>privleap</code> to work around the issue. Implemented the fix, and also silenced some warnings that weren't important for the user to see.

== 2025-10-30 ==
=== Start preparing vm-config-dist to be suitable for installation on all platforms ===
Date: 2025-10-30

vm-config-dist has some things that are useful for Qubes, and we want it installed on the Kicksecure ISO so that if people boot the ISO in a virtual machine, they get the benefits it provides in that VM. Started work to make vm-config-dist able to be installed without issues on all supported platforms.

=== Diagnose, mask cast-qual compilation warning in kloak ===
Date: 2025-10-30

The way in which libwayland-client works ends up with a "const" qualifier being discarded when attaching a listener to an interface. This issue is present in the library itself and also in code automatically generated by wayland-scanner. Determined why it was happening, decided it was likely benign, and added some GCC pragmas to kloak to silence cast-qual warnings from two autogenerated header files.

=== Enable systemd-journald audit transport to fix apparmor-info ===
Date: 2025-10-30

apparmor-info wasn't working because the systemd-journald audit transport was not enabled and apparmor-info attempts to scan messages from that transport. Determined how to enable it, and did so. Needs an image rebuild to test and make sure it fully works, which has not been done yet.

=== Review, adjust backlight tool changes ===
Date: 2025-10-30

Reviewed some changes to backlight-tool-dist that Patrick made, made some changes to strings displayed in the UI.

=== Fix graphical relog in sysmaint sessions ===
Date: 2025-10-30

We weren't taking into account the possibility that someone might log out of a graphical sysmaint session without rebooting. However, one can cause what looks like a relog by running <code>sudo systemctl restart greetd</code>. Upon logging back in, a black screen would be displayed. Determined why the issue was occurring and fixed it.

=== Finish screen locking enhancements ===
Date: 2025-10-30

Added the needed code to disable screen locking under VMs via vm-config-dist. Tested it, appears to work.

== 2025-10-29 ==
=== Improve screen locking experience ===
Date: 2025-10-29

Unified all screen locking controls in helper-scripts' <code>lock-screen</code> script. Added better notifications, LXQt integration, and a much better screen lock notification image.

=== Try to debug dnf-3 issues in Qubes-Whonix-Gateway ===
Date: 2025-10-29

Marek saw an OpenQA failure with the new dnf-3 wrapper. Could not determine what was wrong with it in debugging, may have been a transient issue or related to the fact that we had two different argument injection mechanisms working at the same time. Did some research, shared results in chat, and left things unchanged in this area for now.

== 2025-10-28 ==
=== Add missing systemd units to sysmaint-boot.target ===
Date: 2025-10-28

Found several units we weren't starting in sysmaint session that we were supposed to be, and added them to the "Wants" of sysmaint-boot.target.

=== Write dnf-3 wrapper for dom0 updates over Whonix-Gateway ===
Date: 2025-10-28

Created a proxy argument injection wrapper for dnf-3 to replace the qubes-specific proxy argument injection solution. Mostly works, but Marek spotted issues with it in OpenQA, which I'll need to work on.

=== Review suggested changes tor-control-panel for separating it from anon-connection-wizard ===
Date: 2025-10-28

Looked at and commented on some code changes submtited by troubador. Also mentioned an issue with the "new identity" button.

=== mediawiki-shell static analysis ===
Date: 2025-10-28

Used static analysis tools on mediawiki-shell (BashSupport Pro and Shellcheck) to find and fix a few more issues.

== 2025-10-27 ==
=== Continued review of mediawiki-shell refactoring ===
Date: 2025-10-27

Finished reading through and polishing the mediawiki-shell refactoring work from Ben. Need to still run some analysis tools on it, but it's close to done.

=== Comment on qca-addon-whonix PR from Ben (default dvm set issue) ===
Date: 2025-10-27

Continuing discussion on how to best set the default DispVM for Whonix templates.

== 2025-10-26 ==
=== Finish initial port of sdwdate-gui-client to asyncio and pyinotify ===
Date: 2025-10-26

Originally we were using Qt for sdwdate-gui-client, since it allowed convenient handling of both network and file change notifications. This required more memory than using lower-level frameworks however. Rewrote sdwdate-gui-client to use asyncio and pyinotify instead. The initial port seems to work but needs more review and testing.

=== Begin review of mediawiki-shell refactoring ===
Date: 2025-10-26

Got through a significant portion of the review work, still more than half left to do. Made adjustments as I went.

=== Set resolution of all virtual displays to 1920x1080 if dynamic resize helpers are not available ===
Date: 2025-10-26

If spice-vdagentd is not present and running under KVM, or if VBoxDRMClient is not present and running under VirtualBox, wl_resize_watcher will set the size of all displays on the system to 1920x1080 to avoid issues with the screens being too small.

=== Split set-system-keymap and set-console-keymap ===
Date: 2025-10-26

Created a new wrapper "set-console-keymap" for just setting the console keyboard layout separately from the labwc layout, and made "set-system-keymap" a wrapper around both set-console-keymap and set-labwc-keymap.

=== Fix policy-rc.d deletion issue in qubes-builder-debian ===
Date: 2025-10-26

qubes-builder-debian was not using update-alternatives when installing a policy-rc.d file to prevent service startup during package installation. As a result, our policy-rc.d shipped in user-sysmaint-split was being clobbered. Created a PR to Qubes to fix this, which was merged.

=== Document dnf workaround for libcurl dom0 updates over onion repos on Qubes ===
Date :2025-10-26

Documented the new workaround added to Qubes for allowing DNF to fetch dom0 updates from an onion repo via Whonix-Gateway, and why it was necessary.

== 2025-10-25 ==
=== Reduce Qubes-Whonix memory requirements ===
Date: 2025-10-25

Identified a number of areas where memory usage could be reduced, some that were Qubes-specific and some which weren't, and implemented many of them. (A rewrite of sdwdate_gui_server.py to use asyncio and pyinotify is still in progress.)

=== Add set-system-keymap button to sysmaint-panel ===
Date: 2025-10-25

There is now a button in sysmaint-panel that will launch the system-wide keyboard configuration application.

== 2025-10-24 ==
=== Port live-config-dist to the new set-system-keymap mechanism ===
Date: 2025-10-24

The default keyboard layouts set by Calamares are now set via set-system-keymap rather than a custom, Calamares-specific mechanism.

=== Downgrade hard failures to warnings in most places in wlr_resize_watcher ===
Date: 2025-10-24

Made it so that if an error occurs that will probably render wlr_resize_watcher useless but won't completely break it, it will remain running just in case it can be useful.

=== Test dom0 updates over Whonix-Gateway ===
Date: 2025-10-24

Verified that dom0 is able to use Whonix-Gateway as an update proxy successfully.

=== Actually remove incorrect volume widget from Whonix-Gateway sysmaint waybar ===
Date: 2025-10-24

The initial removal attempt didn't quite work because the pulseaudio widget was still being added, it just wasn't being configured specially in Whonix-Gateway anymore. Fully removed the widget from the panel.

== 2025-10-23 ==
=== File Debian systemd package bug report for enabling X11 keyboard layout changes via systemd-localed ===
Date: 2025-10-23

Filed a bug asking for the X11 keymap setting functionality disabled by systemd-localed-read-only.conf to be enabled somehow. Offered to work on fixing it if possible.

=== Stop installing unnecessary firmware in Qubes OS Kicksecure template ===
Date: 2025-10-23

We were installing GPU and audio card firmware in Kicksecure 18, which is unnecessary (only network and ''maybe'' USB firmware is needed there for use as sys-net and sys-usb). Split out network firmware into a separate metapackage for Kicksecure on Qubes OS to use.

=== Rename sdwdate.Connect(Check) to sdwdate-gui.Connect(Check) ===
Date: 2025-10-23

The old naming was annoying and the Qubes team was fine with me renaming this. Applied the name change to qubes-core-admin-addon-whonix and sdwdate-gui.

=== Review whether anything is left to do on fixing sdwdate-gui qrexec denied messages ===
Date: 2025-10-23

Didn't see anything left to do here, the bug appears to be fixed.

=== Remove incorrect volume widget from Whonix-Gateway sysmaint waybar ===
Date: 2025-10-23

Whonix-Gateway doesn't have an audio device, so the volume widget was useless and just appeared as a random yellow bar in the middle of Waybar. Removed it by splitting the Waybar configuration out of desktop-config-dist and putting it in kicksecure, anon-gw, and anon-ws base files packages, then removing the volume widget config from anon-gw-base-files.

=== Fix systemcheck error trap to return non-zero if a non-zero return code was trapped ===
Date: 2025-10-23

Sourcing systemcheck configuration that was invalid was properly resulting in systemcheck aborting, but was not resulting in systemcheck exiting with a non-zero exit code. Found and implemented a solution.

=== Add hypervisor helper checks to wlr_resize_watcher ===
Date: 2025-10-23

Made it so that wlr_resize_watcher will print an error message and exit if VBoxDRMClient (on VirtualBox) or spice-vdagentd (on KVM) is missing or not running.

=== Debug sdwdate permissions problems on upgraded sys-whonix AppVM ===
Date: 2025-10-23

When switching sys-whonix from a Whonix-Gateway 17 template to a Whonix-Gateway 18 one, the UID/GID on /var/lib/sdwdate was incorrect, since the UID/GID for <code>sdwdate:sdwdate</code> in the Whonix-Gateway 17 template were different than the UID/GID for the Whonix-Gateway 18 template. A tmpfiles.d configuration file should have been fixing this, but it was failing to do so because systemd-tmpfiles-setup.service was starting before qubes-bind-dirs.service. Added an ordering dependency to qubes-bind-dirs.service to fix this and submitted the change as a PR to Qubes.

=== Fix "ignoring exit-on-service-eof=true" warning in Whonix-Gateway 18 on Qubes ===
Date: 2025-10-23

There was a config file we were supposed to override when we fixed the updates proxy startup timing issue. Added an override for that file.

== 2025-10-22 ==
=== Fix up browser-choice Tor Browser plugin, install button availability ===
Date: 2025-10-22

The Tor Browser plugin for browser-choice now simply installs the Tor Browser package and then instructs the user on how to download Tor Browser separately. If a browser is already considered to be installed by browser-choice, the "install" option is grayed out.

=== Remove xscreensaver from release-upgraded systems ===
Date: 2025-10-22

Now that we've ported to Wayland, we don't support xscreensaver anymore, and Qubes doesn't need it even though it uses X still. It causes the screen to go black without warning under Wayland, removing it should prevent that going forward.

=== Remove hardcoded "sleep 10" from Tor startup, replace with IPv6 address listener ===
Date: 2025-10-22

Created a script that listens for the appearance of a hardcoded internal IPv6 address, and allows Tor to start once that address appears (or 10 seconds passes, whichever comes first).

=== Finish changing anon-connection-wizard, tor-control-panel to using privleap for privileged operations ===
Date: 2025-10-22

Code is untested but should work to make these tools functional on Whonix-Gateway with user-sysmaint-split installed.

=== Testing, further polish on keyboard layout code ===
Date: 2025-10-22

Ran through a detailed test plan for the keyboard layout code to ensure it functioned properly in a wide range of situations. Created some bugfixes and merged in a bugfix from Codex.

== 2025-10-21 ==
=== Mostly finish keyboard layout code ===
Date: 2025-10-21

Finished the interactive UI for the keyboard layout customizer, added support for changing the system-wide keyboard layout (including the console layout), and created a thorough test plan for the code (yet to be ran through).

== 2025-10-20 ==
=== Work on polishing keyboard layout change code ===
Date: 2025-10-20

Started creating an interactive UI for changing the keyboard layout under labwc. Also did research into how to configure the system-wide keyboard layout for both Wayland and the console.

=== Fix greetd login failure hang ===
Date: 2025-10-20

greetd would hang on a black screen if the user failed to authenticate properly the first time. Figured out why this was happening and fixed it.

=== Fix several post-upgrade desktop environment issues ===
Date: 2025-10-20

Fixed greetd failing to be enabled, fixed an autologinchange bug that was corrupting a greetd configuration file, and reviewed a change make to sysmaint-boot to ensure that Wayland was the default for the sysmaint session.

== 2025-10-19 ==
=== Research, create qubes-devel thread for avoiding AppVM and NetVM/DispVM mismatches ===
Date: 2025-10-19

Posted a mailing list thread with an idea about how to keep a Qubes ApPVM from being set to use a DispVM or NetVM that is unsafe for that specific VM.

=== Create screen brightness tool for Kicksecure 18 ===
Date: 2025-10-19

The tool uses privleap rather than pkexec as the privilege escalation framework. The security-sensitive components of the code are written in Bash and validate their input thoroughly, so this should be secure.

=== Finish dynamic display resize helper for labwc on VirtualBox and KVM ===
Date: 2025-10-19

Runs as a background process, detects changes in display size and reconfigures the compositor as appropriate when those changes are detected. Tested with both single and multiple screens in VirtualBox, and a single screen in KVM.

=== Reply to kernel lockdown mode Github issue, forum posts ===
Date: 2025-10-19

Replied to forum posts and a Github issue related to enabling kernel lockdown mode. Couldn't think of a scenario where kernel lockdown mode would be substantially useful, but left some notes.

== 2025-10-18 ==
=== Start development of dynamic resolution handler for labwc ===
Date: 2025-10-18

Finished doing the research needed to create a background process that will listen for display resolution change events and resize labwc displays accordingly. This will allow dynamic resolution resizing to work in both VirtualBox and KVM.

=== Investigate display brightness concerns for LXQt on Kicksecure 18 ===
Date: 2025-10-18

pkexec is not executable from a user session, which makes it hard for the LXQt backlight helper to be usable. After some discussion, we've decided to create our own backlight tool for this. Because privleap only streams stdio in one direction, this will need to have a dedicated helper created for it; to avoid needing SUID root and to prevent a persistent daemon from having to run in the background, we can probably use systemd socket activation or D-Bus activation here.

=== Fix repository-dist-wizard UI element overlap issue ===
Date: 2025-10-18

Changed repository-dist-wizard to use layouts rather than manual UI element positioning to avoid overlap issues (these previously resulted in inability to click some buttons).

=== Finish adding user-sysmaint-split to Whonix-Gateway ===
Date: 2025-10-18

Tested a freshly built pair of Whonix 18 KVM images, verified that user-sysmaint-split was present in Whonix-Gateway and functional.

== 2025-10-17 ==
=== Look into further work needed for Kicksecure 18 on Qubes OS, enable user-sysmaint-split on Whonix-Gateway ===
Date: 2025-10-17

Determined that we do not need to do anything about qubes-core-admin-addon-kicksecure's installation on Qubes OS R4.3, as Marek is already planning on ensuring it is installed by default. Changed our code to place user-sysmaint-split on Whonix-Gateway by default after some discussion of attack scenarios with Patrick (not all code changes pushed yet, still testing).

=== Further review on ben-grande's qubes-core-admin-addon-whonix refactor ===
Date: 2025-10-17

Continuing to discuss some implementation details. Once this is done, we should backport this to R4.2 to fix the anonymity bypass via DispVMs in standalones and templates bug.

=== Change passwordless-root to be ephemeral by default in Qubes AppVMs ===
Date: 2025-10-17

Patrick brought up the fact that the <code>passwordless-root</code> command is permanent even in Qubes OS AppVMs, so the unrestricted admin mode fix created previously didn't work as expected. Changed <code>passwordless-root</code> to be ephemeral by default on Qubes, and provide a command-line option for enabling persistence.

== 2025-10-16 ==
=== Review, attempt to send stardict removal request ===
Date: 2025-10-16

Attempted to send the Stardict email, however GMail refused to allow me to send it for some reason. Reviewed email content, removed anything that might look suspicious to GMail and decided to leave it alone for a bit so that any anti-spam measures would have time to calm down.

=== Debug miscellaneous Qubes-related Kicksecure and Whonix issues ===
Date: 2025-10-16

Verified that updates, release upgrades, and user-sysmaint-split work as expected. Determined what was wrong with Kicksecure sys-whonix communication and discussed possible fixes with Patrick.

== 2025-10-15 ==
=== Investigate, write draft email requesting the removal of Stardict from Debian's main repo ===
Date: 2025-10-15

Determined that Debian 12 was still vulnerable to a Stardict CVE that leaked arbitrary clipboard contents. Prepared an email detailing Stardict's history and requesting that the package be demoted to contrib, and shared it with Patrick. This has not yet been submitted to Debian upstream.

=== Investigate missing display resize events in VirtualBox ===
Date: 2025-10-15

Discovered that VirtualBox VMs were not reliably receiving signals when the display is resized, even with VirtualBox guest additions installed. Determined this was the result of a missing executable, <code>VBoxDRMClient</code>. Found a fix and emailed it to the Debian VirtualBox maintainers.

=== Miscellaneous review tasks ===
Date: 2025-10-15

Replied to several PRs and issues. Merged some code from raja-grewal.

=== Test, fix USBGuard in Qubes ===
Date: 2025-10-15

Discovered that USBGuard mostly worked in Qubes, but not entirely. Created fixes for the issues discovered.

== 2025-10-14 ==
=== Implement workaround for approx cache outdated repo metadata in derivative-maker ===
Date: 2025-10-14

Created and tested a fix for approx's occasional failure to download updated package metadata in our build system.

=== Find, fix core issue with Qubes environment fix patch ===
Date: 2025-10-14

The issue with the patch to qubes-gui-runuser was finally found; there was a race condition between systemd attempting to terminate qubes-gui-agent.service and qubes-gui-runuser starting the GUI session. Fixed the issue, the PR now works as expected.

== 2025-10-13 ==
=== Debug approx cache issues, comment on security-related kernel parameters issue on Github ===
Date: 2025-10-13

Debugged and reported a bug about approx's caching issues (it looks like there's possibly a timer not being obeyed). Also did some research on kernel command line maximum length and commented to raja-grewal on a Github issue about the use of <code>mitigations=auto,nosmt</code>.

=== Rework Qubes environment fix patch ===
Date: 2025-10-13

Discarded the original C code changes for importing the environment in qubes-gui-runuser, and attempted to do this in /etc/profile.d instead. Unfortunately this seems to have now caused a sys-gui issue that will need further investigation.

== 2025-10-12 ==
=== Research what is needed to get port from gpg to sequoia-pgp ===
Date: 2025-10-12

Wrote down some suggestions, created a file for tracking progress, and discussed next steps with Patrick.

=== Create Tor version check and update script ===
Date: 2025-10-12

Made a Python script that detects if the version of Tor available from torproject.org is newer than the version in the Kicksecure repositories, and downloads the update into the repository if so.

=== More debugging of Qubes VM shutdown issues with environment fix patch ===
Date: 2025-10-12

Found the root cause of the issue, but I'm still not sure why the code in question is causing the issue. Marek suggested some workarounds which I'll be testing soon.

=== Isolate log filtering code in systemcheck from normal users ===
Date: 2025-10-12

Split out most of the log processing into a new script that runs as user <code>systemcheck</code>. That script can be called by standard users via leaprun, and it in turn can read the system logs, but standard users cannot read system logs. This should prevent access to unhashed kernel pointers, at least through the system logs.

=== Fix sysmaint manual login and related greetd issues ===
Date: 2025-10-12

Patrick discovered that one could log into a full desktop session with the sysmaint user by restarting greetd. Determined why this was happening and fixed it. Also fixed greetd startup when sysmaint autologin is disabled.

=== Fix volume indicator in sysmaint session changing color on hover ===
Date: 2025-10-12

The default Waybar configuration on which our config was based had an unnecessary styling rule that made the volume indicator change color on hover. Removed the rule.

== 2025-10-11 ==
=== Rework keyboard layout handling in Calamares ===
Date: 2025-10-11

Adjusted our keyboard layout helper code so that the keyboard layout was properly set in /etc/default/keyboard and in the labwc compositor. The new code should now support locales that use multiple keyboard layouts by default, and should also work with keyboard layout variants.

=== Further discussion of stalled Qubes OS template shutdown issue ===
Date: 2025-10-11

Determined that the environment variables we needed were available over Varlink. Discussed with Marek whether a script-based solution or the use of Varlink would be worthwhile for fixing the issue.

== 2025-10-10 ==
=== Debug locked-up shutdown of Qubes OS VMs after adding the environment import patch ===
Date: 2025-10-10

Marek discovered that the systemd environment import patch to qubes-gui-runuser resulted in shutdown getting stalled for a minute and a half in some instances. Attempted to determine why, and discussed possible solutions.

=== Fix flickering in Qt apps on Qubes OS triggered by event buffering ===
Date: 2025-10-10

Added some code to qubes-gui-daemon to allow instant passthrough of a few X messages to fix the flicker issue.

=== Add back VirtualBox guest utilities to Kicksecure ISO ===
Date: 2025-10-10

Determined why the VirtualBox guest utilities weren't being installed on the Kicksecure ISO in the first place, fixed the issue that kept them from being installable, and added them. Verified they were present on a newly built ISO.

=== Add display settings button to sysmaint-panel ===
Date: 2025-10-10

You can now launch wdisplays by clicking the display settings button in sysmaint-panel.

== 2025-10-09 ==
=== Discuss solutions for Calamares keyboard layout set failure ===
Date: 2025-10-09

Calamares' keyboard layout settings currently do not work under Wayland due to Debian disabling the mechanism Calamres uses to make keyboard layout changes. Described the issue to Patrick and mentioned possible solutions.

=== Ensure Calamares language setup worked as expected ===
Date: 2025-10-09

Both GUI and CLI modes of user and sysmaint sessions obeyed Calamares' language settings.

=== Investigate debian.sources only being readable by root ===
Date: 2025-10-09

Could not reproduce issue.

=== Create setxkbmap alternative for labwc ===
Date: 2025-10-09

Created set-labwc-keymap, for setting the keyboard layout with labwc. Can make both temporary and persistent changes. Supports keymap options and variants.

=== Research making left click bring up sdwdate-gui menu ===
Date: 2025-10-09

Determined that this was not possible at the moment and recorded why in the corresponding task. Changed a UI string so that users know to right-click on the icon.

=== Add LXQt config and on-screen keyboard to sysmaint-panel ===
Date: 2025-10-09

Added buttons to sysmaint-panel for toggling the on-screen keyboard and launching lxqt-config.

== 2025-10-08 ==
=== Fix Qubes Update failure on Whonix templates ===
Date: 2025-10-08

The ten-second wait added to the Tor startup process was causing the updater to regularly fail on Whonix templates. Changed qubes.UpdatesProxy in Whonix from a symlink to a script that would wait to allow updates to begin until Tor was up-and-running in sys-whonix.

=== Add an on-screen keyboard to Kicksecure and Whonix ===
Date: 2025-10-08

After much research, decided to choose wvkbd as the keyboard to ship. Created a script and desktop files for starting and stopping it.

=== Fix bindp compilation warning caused by incorrect postinst compilation method ===
Date: 2025-10-08

We were embedding a gcc command into the postinst script rather than using the compilation procedure in bindp's Makefile. Fixed this.

=== Finish preparing qubes-gui-runuser.c env var code for review ===
Date: 2025-10-08

Did more testing, fixed remaining TODOs. Pushed the latest version of the env var code and marked it as ready for review.

== 2025-10-07 ==
=== Polish qubes-gui-runuser.c env var code, research slab_debug security concerns ===
Date: 2025-10-07

Fixed several bugs in the draft implementation of the environment variable import code from yesterday, and got the new implementation to work in a Debian 13 Xfce template. Also did substantial research into security concerns around the <code>slab_debug</code> kernel parameter, and how to mitigate them best. Requested that the Debian kernel team backport a new pointer hashing boot parameter from kernel 6.17 into the Trixie stable kernel.

== 2025-10-06 ==
=== Create draft implementation for importing env vars from systemd in qubes-gui-runuser.c ===
Date: 2025-10-06

The preliminary fix for the environment variable bug in Qubes was insufficient because it meant now environment variables from systemd were being clobbered with those from /etc/profile.d. The intended behavior was that environment variables from systemd should be imported, then augmented by /etc/profile.d. Marek suggested implementing code to do this in qubes-gui-runuser.c, using D-Bus to communicate with systemd to get the environment variables and export them into the session. I created an initial rough draft of this implementation and posted it for initial review.

=== Attempt to debug kloak-related systemd unit ordering cycle ===
Date: 2025-10-06

Installed an older version of kloak into a Debian 13 GNOME VM. Could not reproduce issue, waiting on more info.

=== Remove sanitizers from compiled code ===
Date: 2025-10-06

We were enabling sanitizers such as AddressSanitizer and UndefinedBehaviorSanitizer as a hardening measure, but it turns out this actually made programs less secure and that these sanitizers are not intended for production code. Disabled C sanitizers on all of our C code.

== 2025-10-05 ==
=== Investigate Qubes input event buffering flicker bug with Qt ===
Date: 2025-10-05

Previously I discovered that Qt apps had some odd flickering behavior with some menus when input event buffering was enabled. Attempted to find the root cause, the cause hasn't been identified for certain but a possible problem has been identified. Discussed it with Marek briefly.

=== Test socat's suitability for use as a DNS proxy in sys-net ===
Date: 2025-10-05

Got socat working so that IPv6 DNS on an IPv6 network worked. Discussed the suitability of this solution with Marek.

=== Debug, create preliminary fix for Qubes-Whonix file manager launch bug ===
Date: 2025-10-05

Marek discovered that the default file manager in Whonix 18 was Catfish, when it should be PCManFM-Qt. After much study it was discovered this was the result of an outdated xdg override combined with an environment variable loading issue in Qubes OS itself. Filed a bug report for the environment variable load issue, discussed possible ways of fixing it with Marek, and submitted a PR. A different approach than the one provided in the PR will need to be used in the long run.

== 2025-10-04 ==
=== Test Qubes OS IPv6 DNS PRs ===
Date: 2025-10-04

Closely read through, polished, and tested the IPv6 DNS PRs from 3nprob. Unfortunately the approach being used by them is insufficient on its own due to some routers exposing a DNS server on a link-local IPv6 address, which cannot be properly targetted by a DNAT rule. Some sort of manual forwarding using a tool such as socat will likely be required.

= Footnotes =
<references />
{{Footer}}